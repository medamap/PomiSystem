# SNES BG Converter

スーパーファミコン向け背景画像変換ツール (拡張仕様対応)

## 概要

任意の画像を SNES の BG 制約に合わせて変換する。標準仕様に加え、最大32パレット・CHR 4096までの拡張仕様にも対応している。

## 対応仕様

### SNES 標準相当

- 解像度: 256 x 224
- タイル: 8 x 8 ピクセル
- パレット: 8本 x 16色 (共通背景色 + 15色)
- 色空間: RGB555 (32768色)
- CHR 定義数: 標準 1024

### 拡張出力

- QVGA (320 x 240)
- QVGA 2倍 (640 x 480)
- オート (アスペクト比維持)
- パレット本数: 最大 32本
- CHR 定義数上限: 最大 4096

## 機能

### 出力設定

| 項目 | 選択肢 |
|---|---|
| 出力サイズモード | SNES標準 (256x224), QVGA, QVGA 2倍, オート |
| トリミング位置 | 25% - 75% (上下または左右) |
| ディザリング | なし, 市松模様, Bayer 2x2, Bayer 4x4 |

### パレット設定 (拡張)

| 項目 | 範囲 | 標準値 |
|---|---|---|
| パレット本数 | 8 - 32 (4刻み) | 8 |
| パレット内色数 | 16 (固定) | 16 |

最大色数は `1 + パレット本数 × 15` (共通背景色 + 各パレット15色)。

### CHR 設定

| 項目 | 範囲 | 標準値 |
|---|---|---|
| CHR定義数上限 | 256 - 4096 | 1024 |
| タイル類似度閾値 | 0 - 50 | 10 |

類似度閾値を上げるとタイル統合が進み CHR 使用数は減るが、画質が低下する。

### 色調整

| 項目 | 範囲 |
|---|---|
| 明度 | -100 - +100 |
| コントラスト | -100 - +100 |
| 彩度 | -100 - +100 |

### その他

- リアルタイムプレビュー (重い場合は OFF 推奨)
- 設定保存 / リセット

## 処理フロー

1. 画像読み込みとトリミング
2. 色調整 (明度, コントラスト, 彩度)
3. 8x8 タイル単位でパレット候補を抽出
4. パレット生成 (共通背景色 + 各パレット15色)
5. タイルごとのパレット割り当て
6. ディザリングと減色
7. CHR タイル抽出と類似タイル統合
8. 出力画像と CHR 定義画像の生成

## 出力形式

### 出力画像

変換後の画像。PNG 形式で保存またはクリップボードにコピーできる。

### CHR 定義画像

使用されるタイルを並べた画像。16タイル/行で配置し、PNG 形式で保存できる。

## 使い方

1. 画像をドラッグアンドドロップまたはファイル選択で読み込む
2. 出力モードと各種設定を調整
3. 「変換実行」ボタンをクリック
4. 出力画像と CHR 定義画像を保存またはコピー

## 既知の問題

特になし。

## 技術詳細

- RGB555 色空間から自動的に最適なパレットを生成
- パレットはタイル単位で割り当て、共通背景色を共有
- CHR 定義画像は 8x8 タイルを 16列で配置
